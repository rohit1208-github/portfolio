(()=>{var e={};e.id=220,e.ids=[220],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1645:e=>{"use strict";e.exports=require("net")},1997:e=>{"use strict";e.exports=require("punycode")},2430:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>p,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{POST:()=>c});var o=r(6559),n=r(8088),u=r(7719),i=r(2190),a=r(7450);async function c(e){if(e.headers.get("x-api-key")!==process.env.DOCUMENT_API_KEY)return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let t=(await e.formData()).get("file");if(!t)return i.NextResponse.json({error:"No file provided"},{status:400});let r=Buffer.from(await t.arrayBuffer()),s=await (0,a.j)(r,t.name);return i.NextResponse.json(s)}catch(e){return console.error("Error in documents route:",e),i.NextResponse.json({error:"Failed to process document"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/documents/route",pathname:"/api/documents",filename:"route",bundlePath:"app/api/documents/route"},resolvedPagePath:"/Users/samjoshuva/Downloads/personal-rag-bot/app/api/documents/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:m}=p;function x(){return(0,u.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4075:e=>{"use strict";e.exports=require("zlib")},4631:e=>{"use strict";e.exports=require("tls")},4735:e=>{"use strict";e.exports=require("events")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{"use strict";e.exports=require("crypto")},5591:e=>{"use strict";e.exports=require("https")},6487:()=>{},7450:(e,t,r)=>{"use strict";r.d(t,{j:()=>l,N:()=>m});var s=r(9326),o=r(2125),n=r(7449),u=r(6345);let i=process.env.SUPABASE_SERVICE_ROLE_KEY,a=(0,u.UU)("https://bvbtsfcgiauheudzbfvr.supabase.co",i,{auth:{persistSession:!1}});var c=r(4420);class p{constructor(e){this.caller=void 0,this.model=new n.ij(e)}async embedQuery(e){let t=this.model.getGenerativeModel({model:"embedding-001"});return(await t.embedContent(e)).embedding.values}async embedDocuments(e){let t=[];for(let r of e){let e=await this.embedQuery(r);t.push(e)}return t}}let d=new p(process.env.GOOGLE_API_KEY);async function l(e,t){let r=[];if(t.endsWith(".md")){let s=e.toString("utf-8");r=[new c.y({pageContent:s,metadata:{source:t}})]}else throw Error("Unsupported file type");let n=new o.Q({chunkSize:1e3,chunkOverlap:200}),u=await n.splitDocuments(r);return console.log("vectorStore :",await s.l.fromDocuments(u,d,{client:a,tableName:"document_embeddings",queryName:"match_documents"})),{documentId:t,chunkCount:u.length}}async function m(e){let t=new s.l(d,{client:a,tableName:"document_embeddings",queryName:"match_documents"});return await t.similaritySearch(e,5)}},7598:e=>{"use strict";e.exports=require("node:crypto")},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,691],()=>r(2430));module.exports=s})();